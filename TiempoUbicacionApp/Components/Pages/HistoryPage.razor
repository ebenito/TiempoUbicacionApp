@page "/history"
@using TiempoUbicacionApp.Models
@using TiempoUbicacionApp.Services
@inject LocationDatabaseService DatabaseService

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">

    <MudText Typo="Typo.h4" Color="Color.Primary" Class="mb-4" Style="margin-left: 4vw;">📜 Historial de registros</MudText>

    @if (entries == null)
    {
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" Size="Size.Large" />
    }
    else if (!entries.Any())
    {
        <MudAlert Severity="Severity.Info" Elevation="1">No hay registros guardados.</MudAlert>
    }
    else
    {
        <MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
            <MudCard>
                <MudCardHeader>
                    <MudText Typo="Typo.h6">Histórico de datos</MudText>
                </MudCardHeader>
                <MudCardContent>
                    <MudTable Items="@entries" Dense="true" Hover="true" Bordered="true" Striped="true">
                        <HeaderContent>
                            <MudTh>Fecha</MudTh>
                            <MudTh>Hora Local</MudTh>
                            <MudTh>UTC</MudTh>
                            <MudTh>Ubicación</MudTh>
                            <MudTh>Coordenadas</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Fecha">@context.fechaActual</MudTd>
                            <MudTd DataLabel="Hora Local">@context.horaLocal</MudTd>
                            <MudTd DataLabel="UTC">@context.horaUtc <span> - Desfase: @context.desfase</span><br /><span>@context.tipoHorario</span></MudTd>
                            <MudTd DataLabel="Ubicación">@context.Location</MudTd>
                            <MudTd DataLabel="Coordenadas:"><span>Latitud: @context.Latitude</span> <br /><span>Longitud: @context.Longitude</span></MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudCardContent>
            </MudCard>
        </MudContainer>

       @*  <MudGrid GutterSize="3">
            @foreach (var entry in entries)
            {
                <MudItem xs="12">
                    <MudPaper Class="p-4 entry-card" Elevation="1" Style="background-color: #D7CCC8;">
                        <MudText Typo="Typo.h6" Color="Color.Secondary">   @entry.fechaActual — @entry.horaLocal (@entry.tipoHorario)</MudText>
                        <MudDivider Class="my-2" />
                        <MudText><strong>UTC:</strong> @entry.horaUtc</MudText>
                        <MudText><strong>Desfase:</strong> @entry.desfase</MudText>
                        <MudText><strong>Ubicación:</strong> @entry.Location</MudText>
                        <MudText><strong>Coordenadas:</strong><span>Lat.:</span> @entry.Latitude, <span>Long.:</span> @entry.Longitude</MudText>
                    </MudPaper>
                </MudItem>
            }
        </MudGrid> *@
    }

</MudContainer>

@code {
    private List<LocationEntry> entries;

    protected override async Task OnInitializedAsync()
    {
        entries = await DatabaseService.GetAllEntriesAsync();
    }
}
